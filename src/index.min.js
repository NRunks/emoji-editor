"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}var base_canvas=document.getElementById("baseCanvas"),base_context=base_canvas.getContext("2d"),baseRect=base_canvas.getBoundingClientRect(),current_overlay_id=null,current_overlay_canvas=base_canvas,current_overlay_context=base_context,current_cursor_layout_id=null,current_cursor_layout_canvas=null,current_cursor_layout_context=null,isOverlayChanged=!1;base_canvas.addEventListener("focus",preventFocus);var activeTabIndex=0,manipulationNumber=0,emojiCanvasCounter=1,captionCanvasCounter=1,emojiCanvasLeftOffset=0,emojiCanvasTopOffset=0,overlayIDArray=[],emojiArray=[],captionArray=[],drawArray=[],isEmojiRotating=!0,isResizingEmoji=!1,emojiCurrentlyRotating=null,emojiCurrentlyResizing=null,clickX=new Array,clickY=new Array,clickDrag=new Array,cursorX=null,cursorY=null,clickColor=new Array,clickSize=new Array,eraseX=new Array,eraseY=new Array,eraseWidth=new Array,isDrawing=!1,currentDrawRGBValues=null,currentClickSize=null,currentTool="Marker";function downloadCanvas(){if(1===$("#parent-container").find("canvas").length){removeOverlayingEmojiCanvases(),removeOverlayingCaptionCanvases();base_canvas.toDataURL("image/png");var e=document.createElement("a");e.download=Date.now()+".png",e.href=base_canvas.toDataURL("image/png").replace("image/png","image/octet-stream"),e.click()}else alert("You should merge the canvas before downloading!")}function handleMergeClick(){if($(".merge-modal").remove(),1<$("#parent-container").find("canvas").length){var e=document.querySelector("body"),t=document.createElement("div");t.setAttribute("id","browser-overlay"),t.innerHTML="",e.appendChild(t),$("body").append('<div id="mergeModal" class="merge-modal"><div class="merge-modal-content">\n          <div class="merge-modal-header">\n            <span class="modal-close">&times;</span>\n            <h2>Do you want to merge this canvas?</h2>\n          </div>\n          <div class="merge-modal-body">\n            <p>This action cannot be undone.</p>\n          </div>\n          <div class="merge-modal-footer">\n            <button id="confirmMergeModalButton" class="merge-modal-button">Yes</button>\n            <button id="cancelMergeModalButton" class="merge-modal-button">Cancel</button>\n          </div>\n        </div></div>'),$(".modal-close").on("mousedown",function(e){$("#mergeModal").remove(),$("#browser-overlay").remove()}),$("#cancelMergeModalButton").on("click",function(e){$("#mergeModal").remove(),$("#browser-overlay").remove()}),$("#confirmMergeModalButton").on("click",function(e){mergeLayers(),1==activeTabIndex&&attachDrawHandlers(),$("#mergeModal").remove(),$("#browser-overlay").remove()})}}function mergeLayers(){var n=base_canvas.getBoundingClientRect(),a=base_canvas.getContext("2d");_toConsumableArray(document.querySelectorAll("canvas")).forEach(function(e){var t=e.getBoundingClientRect();a.drawImage(e,t.left-n.left,t.top-n.top)}),removeOverlayingEmojiCanvases(),removeOverlayingCaptionCanvases(),$(".overlay-container").remove(),$("caption-overlay").remove(),clickX=new Array,clickY=new Array,clickDrag=new Array,clickColor=new Array,clickSize=new Array,eraseX=new Array,eraseY=new Array,eraseWidth=new Array,isDrawing=!1}function undoLayer(){var e=_toConsumableArray(document.querySelectorAll("canvas"));if(0<e.length){var t=e.pop();"baseCanvas"!==t.id&&$("#".concat(t.parentElement.id)).remove()}}function isCanvasOverlapping(e,t){return e.left<=t.right&&e.top<=t.bottom&&e.right>=t.left&&e.bottom>=t.top}document.getElementById("downloadButton").addEventListener("click",downloadCanvas),$("#emojis").on("click",function(e){var t=document.querySelectorAll(".caption-canvas");t&&0<t.length&&drawCaptionsToCanvas(),removeAllHandlers(),current_overlay_canvas&&$("#".concat(current_overlay_canvas.id)).off(),$("li#draw").removeClass("active"),$("li#caption").removeClass("active"),$("li#emojis").addClass("active"),$("#undoButton").removeClass("disabled"),$(".caption-overlay.snapchat").remove(),$("#emoji-container").fadeIn(200),1===activeTabIndex?($("#draw-container").fadeOut(300,function(){this.remove()}),$("#tool-tab-content").append($("#emoji-container-template").html())):2===activeTabIndex&&($("#caption-container").fadeOut(300,function(){this.remove()}),$("#tool-tab-content").append($("#emoji-container-template").html()));for(var n=document.getElementsByClassName("hex-emoji"),a=0;a<n.length;a++)n[a].addEventListener("click",handleEmojiListClick);activeTabIndex=0,removeOverlayingCaptionCanvases(),removeCanvasPointerEvents()});var templateHTML=$("#emoji-container-template").html();$("#tool-tab-content").append(templateHTML);for(var R2D,rotateActive,angle,center,init,rotate,rotation,start,startAngle,stop,emojiList=document.getElementsByClassName("hex-emoji"),i=0;i<emojiList.length;i++)emojiList[i].addEventListener("click",handleEmojiListClick);function handleEmojiListClick(e){if(emojiCanvasCounter<=35){$("#parent-container").append('<div id="emoji-canvas-container'.concat(emojiCanvasCounter,'" class="stretch-x emoji-canvas-container">\n                <canvas id="emojiCanvas').concat(emojiCanvasCounter,'" class="emoji-canvas"></canvas>\n                <span class="delete-emoji">\n                <img src="./src/icons/red-cancel-48.png"/></span>\n\n                <span class="rotate-emoji">\n                <img src="./src/icons/blue-rotate-48.png"/></span>\n\n                <span class="resize-emoji">\n                <img src="./src/icons/actions-expand-512.png"/></span>\n            <div class="stretch-y">\n              <span class="hidden-emoji" id="target-emoji').concat(emojiCanvasCounter,'">').concat(e.target.textContent,"</span>\n            </div>\n          </div>"));var t=document.getElementById("emojiCanvas"+emojiCanvasCounter),n=t.getContext("2d"),a=$("#emoji-canvas-container"+emojiCanvasCounter);a.css({"z-index":10*(manipulationNumber+1)+10*emojiCanvasCounter+2});var o=175;$("#target-emoji".concat(emojiCanvasCounter)).css({"font-size":o+"px"}),t.width=a.width(),t.height=a.height(),n.font="".concat(o,"px Arial"),n.fillText(e.target.textContent,0,o),emojiArray.push({id:"emoji-canvas-container"+emojiCanvasCounter,emoji_code:e.target.textContent,angle:0,font:o,width:t.width,height:t.height}),a.hover(function(){$(".delete-emoji").addClass("active"),$(".rotate-emoji").addClass("active"),$(".resize-emoji").addClass("active")},function(){$(".delete-emoji").removeClass("active"),$(".rotate-emoji").removeClass("active"),$(".resize-emoji").removeClass("active")}),a.draggable({containment:"#parent-container"}),$("#emoji-canvas-container".concat(emojiCanvasCounter," .delete-emoji")).mousedown(function(e){var t=$("#"+this.parentElement.id);t.off(),t.remove()}),$("#emoji-canvas-container"+emojiCanvasCounter+" .resize-emoji").mousedown(function(e){emojiCurrentlyResizing=this.parentElement.id,isResizingEmoji=!0;var t=$("#"+this.parentElement.id),n=t.find("span.hidden-emoji"),a=t.find("canvas"),o=getEmojiIndexByID(this.parentElement.id);emojiCurrentlyResizing&&-1!==o&&startResizingEmoji(e,$("#"+this.parentElement.id),n,a,o)}),$("#emoji-canvas-container".concat(emojiCanvasCounter," .rotate-emoji")).mousedown(function(e){emojiCurrentlyRotating=this.parentElement.id,isEmojiRotating=!0,startRotatingEmoji(e,$("#"+emojiCurrentlyRotating))}),emojiCanvasCounter+=1,emojiCanvasLeftOffset+=32,isOverlayChanged=!0}else alert("Too many emojis present!!! Can't create any more.")}function startResizingEmoji(e,t,n,a,o){n.width(e.clientX-t.offset().left),n.height(e.clientX-t.offset().left),t.draggable("disable"),t.addClass("active")}function stopResizingEmoji(e,t,n,a,o){isResizingEmoji=!1,emojiCurrentlyResizing=null,window.removeEventListener("mousemove",startResizingEmoji,!1),window.removeEventListener("mouseup",stopResizingEmoji,!1);var r=t.get(0).id,i=t.css("z-index"),c=t.find("canvas")[0].id,l=($("#".concat(c)).css("z-index"),t.find("span.hidden-emoji")[0].id),s=getEmojiIndexByID(r),d=emojiArray[s].emoji_code,u=e.clientX-t.offset().left;t.remove(),$("#parent-container").append('<div id="'.concat(r,'" class="stretch-x emoji-canvas-container">\n                <canvas id="').concat(c,'" class="emoji-canvas"></canvas>\n                <span class="delete-emoji">\n                <img src="./src/icons/red-cancel-48.png"/></span>\n\n                <span class="rotate-emoji">\n                <img src="./src/icons/blue-rotate-48.png"/></span>\n\n                <span class="resize-emoji">\n                <img src="./src/icons/actions-expand-512.png"/></span>\n            <div class="stretch-y">\n              <span class="hidden-emoji" id="').concat(l,'">').concat(d,"</span>\n            </div>\n          </div>"));var v=(a=document.getElementById(c)).getContext("2d"),m=$("#".concat(r));m.css({"z-index":i}),$("#".concat(l)).css({"font-size":u+"px"}),a.width=m.width(),a.height=m.height(),v.font="".concat(u,"px Arial"),v.fillText(emojiArray[s].emoji_code,0,u),emojiArray[s].width=a.width,emojiArray[s].height=a.height,emojiArray[s].font=u,m.hover(function(){$(".delete-emoji").addClass("active"),$(".rotate-emoji").addClass("active"),$(".resize-emoji").addClass("active")},function(){$(".delete-emoji").removeClass("active"),$(".rotate-emoji").removeClass("active"),$(".resize-emoji").removeClass("active")}),m.draggable({containment:"#parent-container"}),$("#".concat(r," .delete-emoji")).mousedown(function(e){var t=$("#"+r);t.off(),t.remove()}),$("#".concat(r," .resize-emoji ")).mousedown(function(e){emojiCurrentlyResizing=r,isResizingEmoji=!0;var t=$("#"+r),n=t.find("span.hidden-emoji"),a=t.find("canvas");emojiCurrentlyResizing&&-1!==s&&startResizingEmoji(e,t,n,a,s)}),$("#".concat(r," .rotate-emoji ")).mousedown(function(e){emojiCurrentlyRotating=r,isEmojiRotating=!0,startRotatingEmoji(e,m)})}$(window).mousemove(function(e){isResizingEmoji&&emojiCurrentlyResizing&&startResizingEmoji(e,$("#"+emojiCurrentlyResizing),$("#"+emojiCurrentlyResizing).find("span.hidden-emoji"),$("#"+emojiCurrentlyResizing).find("canvas"),getEmojiIndexByID(emojiCurrentlyResizing)),!0===isEmojiRotating&&emojiCurrentlyRotating&&rotateEmoji(e,$("#"+emojiCurrentlyRotating),getEmojiIndexByID(emojiCurrentlyRotating))}),$(window).mouseup(function(e){isResizingEmoji&&emojiCurrentlyResizing&&stopResizingEmoji(e,$("#"+emojiCurrentlyResizing),$("#"+emojiCurrentlyResizing).find("span.hidden-emoji"),$("#"+emojiCurrentlyResizing).find("canvas"),getEmojiIndexByID(emojiCurrentlyResizing)),!0===isEmojiRotating&&emojiCurrentlyRotating&&(stopRotatingEmoji(e,$("#"+emojiCurrentlyRotating),getEmojiIndexByID(emojiCurrentlyRotating)),isEmojiRotating=!1,emojiCurrentlyRotating=null)}),rotateActive=!1,center={x:startAngle=rotation=angle=0,y:0};var currentCanvas=null,currentContext=null;function startRotatingEmoji(e,t){var n,a,o,r,i,c,l;return e.preventDefault(),t.draggable("disable"),o=(l=t[0].getBoundingClientRect()).top,a=l.left,n=l.height,r=l.width,center={x:a+r/2,y:o+n/2},i=e.clientX-center.x,c=e.clientY-center.y,startAngle=R2D*Math.atan2(c,i),currentCanvas=t.get(0).getElementsByClassName("emoji-canvas")[0],currentContext=currentCanvas.getContext("2d"),rotateActive=!0}function rotateEmoji(e,t,n){var a,o,r;e.preventDefault(),o=e.clientX-center.x,r=e.clientY-center.y,a=R2D*Math.atan2(r,o),rotation=a-startAngle,rotateActive&&requestAnimationFrame(function(){currentContext.clearRect(0,0,currentContext.canvas.width,currentContext.canvas.height),currentContext.translate(currentContext.canvas.width/2,currentContext.canvas.width/2),currentContext.rotate(.1*rotation*Math.PI/180),currentContext.translate(-currentContext.canvas.width/2,-currentContext.canvas.width/2),currentContext.font="".concat(emojiArray[n].font,"px Arial"),currentContext.fillText(emojiArray[n].emoji_code,0,emojiArray[n].font)})}function stopRotatingEmoji(e,t,o){return e.preventDefault(),emojiArray[o].angle+=rotation,t.draggable("enable"),isEmojiRotating=rotateActive=!1,emojiCurrentlyRotating="",$("#".concat(t.get(0).id," .delete-emoji")).mousedown(function(e){var t=$("#"+this.parentElement.id);t.off(),t.remove()}),$("#".concat(t.get(0).id," .resize-emoji ")).mousedown(function(e){emojiCurrentlyResizing=this.parentElement.id,isResizingEmoji=!0;var t=$("#"+emojiCurrentlyResizing),n=t.find("span.hidden-emoji"),a=t.find("canvas");emojiCurrentlyResizing&&-1!==o&&startResizingEmoji(e,t,n,a,o)}),$("#".concat(t.get(0).id," .rotate-emoji ")).mousedown(function(e){emojiCurrentlyRotating=t.get(0).id,isEmojiRotating=!0,startRotatingEmoji(e,t)}),rotateActive}function getEmojiIndexByID(e){for(var t=0;t<emojiArray.length;t++)if(emojiArray[t].id===e)return t;return-1}function drawEmojisToCanvas(){if(0===activeTabIndex){addOverlay(base_canvas,"emoji");base_canvas.getBoundingClientRect();var n=current_overlay_canvas.getBoundingClientRect();_toConsumableArray(document.querySelectorAll(".emoji-canvas")).forEach(function(e){var t=e.getBoundingClientRect();current_overlay_context.drawImage(e,t.left-n.left,t.top-n.top)})}}function preventFocus(e){e.preventDefault(),e.relatedTarget?e.relatedTarget.focus():e.currentTarget.blur()}R2D=180/Math.PI;var colorPickerDisplay=null;$("#draw").on("click",function(e){if(removeAllHandlers(),$("li#emojis").removeClass("active"),$("li#caption").removeClass("active"),$("li#draw").addClass("active"),$(".caption-overlay.snapchat").remove(),window.scrollTo({top:0,left:0,behavior:"smooth"}),$("#draw-container").fadeIn(200),0===activeTabIndex){var t=document.querySelectorAll(".emoji-canvas");t&&0<t.length&&drawEmojisToCanvas(),$("#emoji-container").fadeOut(300,function(){this.remove(),$("#tool-tab-content").append($("#draw-container-template").html()),currentDrawRGBValues&&(document.getElementById("redDrawColorSelector").value=currentDrawRGBValues.red,document.getElementById("greenDrawColorSelector").value=currentDrawRGBValues.green,document.getElementById("blueDrawColorSelector").value=currentDrawRGBValues.blue,(colorPickerDisplay=document.getElementById("colorDrawDisplay")).style.background="rgba(".concat(currentDrawRGBValues.red,", ").concat(currentDrawRGBValues.green,", ").concat(currentDrawRGBValues.blue,", 1)")),currentClickSize&&(document.getElementById("strokeWidthSelector").value=currentClickSize),initiateDrawColorPicker(),initializeBrush(),initiateDrawTools()})}else if(2===activeTabIndex){var n=document.querySelectorAll(".caption-canvas");n&&0<n.length&&drawCaptionsToCanvas(),$("#caption-container").fadeOut(300,function(){this.remove(),$("#tool-tab-content").append($("#draw-container-template").html()),currentDrawRGBValues&&(document.getElementById("redDrawColorSelector").value=currentDrawRGBValues.red,document.getElementById("greenDrawColorSelector").value=currentDrawRGBValues.green,document.getElementById("blueDrawColorSelector").value=currentDrawRGBValues.blue,(colorPickerDisplay=document.getElementById("colorDrawDisplay")).style.background="rgba(".concat(currentDrawRGBValues.red,", ").concat(currentDrawRGBValues.green,", ").concat(currentDrawRGBValues.blue,", 1)")),currentClickSize&&(document.getElementById("strokeWidthSelector").value=currentClickSize),initiateDrawColorPicker(),initializeBrush(),initiateDrawTools()})}clickX=new Array,clickY=new Array,clickDrag=new Array,clickColor=new Array,clickSize=new Array,eraseX=new Array,eraseY=new Array,eraseWidth=new Array,isDrawing=!1,current_overlay_canvas&&$("#".concat(current_overlay_canvas.id)).off(),setTimeout(function(){attachDrawHandlers()},2200),removeOverlayingEmojiCanvases(),removeOverlayingCaptionCanvases(),addCanvasPointerEvents(),activeTabIndex=1});var foo=!1;function attachDrawHandlers(){current_overlay_canvas&&$("#".concat(current_overlay_canvas.id)).off(),addOverlay(base_canvas,"draw"),$("#".concat(current_overlay_canvas.id)).on("mouseleave",function(e){var t=_toConsumableArray(document.querySelectorAll(".overlay-container")),n=t.pop();$("#".concat(n.id)).remove(),foo=!0,0<t.length?$("#".concat(t[t.length-1].id)).on("mouseenter",function(e){foo&&(attachDrawHandlers(),foo=!1)}):$("#".concat(base_canvas.id)).on("mouseenter",function(e){foo&&(attachDrawHandlers(),foo=!1)})}),$("#".concat(current_overlay_canvas.id)).on("mousedown",drawHandler),$("#".concat(current_overlay_canvas.id)).on("mousemove",function(e){redraw(current_overlay_context),drawCursor(base_canvas,current_overlay_canvas,current_overlay_context,e,currentClickSize)})}var drawHandler=function(e){var t=this.getBoundingClientRect();e.pageX,t.left,e.pageY,t.top;isDrawing=!0,currentTool!==document.getElementById("dropperButton").value&&(isOverlayChanged=!0),addClick(e.pageX-t.left,e.pageY-t.top),redraw(current_overlay_context),$("#".concat(current_overlay_canvas.id)).on("mousemove",drawMoveHandler),$("#".concat(current_overlay_canvas.id)).on("mouseup",function(e){redraw(current_overlay_context),isOverlayChanged=!1,$("#".concat(current_overlay_canvas.id)).off(),attachDrawHandlers(),isDrawing=!1}),$("#".concat(current_overlay_canvas.id)).on("mouseleave",function(e){redraw(current_overlay_context),isOverlayChanged=!1,$("#".concat(current_overlay_canvas.id)).off(),attachDrawHandlers(),isDrawing=!1})},drawMoveHandler=function(e){var t=this.getBoundingClientRect();addClick(e.pageX-t.left,e.pageY-t.top,!0),redraw(current_overlay_context),drawCursor(base_canvas,current_overlay_canvas,current_overlay_context,e,currentClickSize)};function addClick(e,t,n){currentTool===document.getElementById("eraserButton").value?(eraseCanvas(base_context,current_overlay_context,e,t,currentClickSize),eraseX.push(e),eraseY.push(t),eraseWidth.push(currentClickSize)):currentTool===document.getElementById("dropperButton").value?getColorAtPoint(e,t,base_context):(clickX.push(e),clickY.push(t),clickDrag.push(n),clickSize.push(currentClickSize),clickColor.push("rgba(".concat(currentDrawRGBValues.red,", ").concat(currentDrawRGBValues.green,", ").concat(currentDrawRGBValues.blue,", 1)")))}function redraw(e){if(e){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.lineJoin="round";for(var t=0;t<clickX.length;t++)e.beginPath(),clickDrag[t]&&t?e.moveTo(clickX[t-1],clickY[t-1]):e.moveTo(clickX[t]-1,clickY[t]),e.lineTo(clickX[t],clickY[t]),e.closePath(),e.strokeStyle=clickColor[t],e.lineWidth=clickSize[t]||"5",e.stroke();for(t=0;t<eraseX.length;t++)eraseCanvas(base_context,current_overlay_context,eraseX[t],eraseY[t],eraseWidth[t])}}function eraseCanvas(e,t,n,a,o){var r=e.getImageData(n,a,o,o);t.putImageData(r,n,a,0,0,o,o)}function drawCursor(e,t,n,a,o){if(e&&t&&n&&a&&o){var r=base_canvas.getBoundingClientRect();cursorX=a.clientX-r.left,cursorY=a.clientY-r.top,document.getElementById("eraserButton")&&currentTool===document.getElementById("eraserButton").value?(n.fillStyle="#FF6A6A",n.fillRect(cursorX,cursorY,o,o)):document.getElementById("dropperButton")&&currentTool===document.getElementById("dropperButton").value?(n.beginPath(),n.arc(cursorX,cursorY,5,0,2*Math.PI,!0),n.lineWidth=2,n.strokeStyle="rgba(255, 106, 106, 0.85)",n.stroke()):(n.beginPath(),n.arc(cursorX,cursorY,.5*o,0,2*Math.PI,!0),n.fillStyle="#FF6A6A",n.fill())}}function getColorAtPoint(e,t,n){var a=event.layerX,o=event.layerY,r=n.getImageData(a,o,1,1).data,i=r[0],c=r[1],l=r[2];r[3];document.getElementById("redDrawColorSelector").value=i,document.getElementById("greenDrawColorSelector").value=c,document.getElementById("blueDrawColorSelector").value=l;var s="rgba(".concat(i,", ").concat(c,", ").concat(l,", 1)");document.getElementById("colorDrawDisplay").style.background=s,currentDrawRGBValues={red:i,green:c,blue:l,alpha:"1"}}function initiateDrawColorPicker(){var e=document.querySelectorAll("input.color-input"),t=document.getElementById("redDrawColorSelector").value,n=document.getElementById("greenDrawColorSelector").value,a=document.getElementById("blueDrawColorSelector").value;if((colorPickerDisplay=document.getElementById("colorDrawDisplay"))&&t&&n&&a&&(colorPickerDisplay.style.background="rgba(".concat(t,", ").concat(n,", ").concat(a,", 1)")),e&&0<e.length)for(var o=0;o<e.length;o++)e[o].addEventListener("input",function(){t=document.getElementById("redDrawColorSelector").value,n=document.getElementById("greenDrawColorSelector").value,a=document.getElementById("blueDrawColorSelector").value,(colorPickerDisplay=document.getElementById("colorDrawDisplay"))&&t&&n&&a&&(colorPickerDisplay.style.background="rgba(".concat(t,", ").concat(n,", ").concat(a,", 1)"),currentDrawRGBValues={red:t,green:n,blue:a,alpha:"1"})});currentDrawRGBValues={red:t,green:n,blue:a}}function initializeBrush(){var e=document.querySelectorAll("input.brush-input");if(currentClickSize=document.getElementById("strokeWidthSelector").value,e&&0<e.length)for(var t=0;t<e.length;t++)e[t].addEventListener("input",function(){currentClickSize=document.getElementById("strokeWidthSelector").value})}function initiateDrawTools(){$("#markerButton").button("toggle"),currentTool=document.getElementById("markerButton").value;for(var e=document.querySelectorAll("#draw-tools .btn"),t=0;t<e.length;t++)e&&0<e.length&&e[t].addEventListener("click",function(){switch(currentTool=document.getElementById(this.children[0].id).value){case document.getElementById("eraserButton").value:case document.getElementById("dropperButton").value:for(e=document.querySelectorAll("input.color-input"),t=0;t<e.length;t++)e[t].disabled=!0;break;default:for(var e=document.querySelectorAll("input.color-input"),t=0;t<e.length;t++)e[t].disabled=!1}})}var currentColorRGBValues=null;colorPickerDisplay=null;function handleCaptionClick(l,e,t){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,o=(5<arguments.length&&void 0!==arguments[5]&&arguments[5],6<arguments.length&&void 0!==arguments[6]?arguments[6]:0),r=7<arguments.length&&void 0!==arguments[7]?arguments[7]:0;if((captionCanvasCounter=n||captionCanvasCounter)<=35){$("#parent-container").append('<div id="caption-canvas-container'.concat(captionCanvasCounter,'" class="stretch-x caption-canvas-container">\n                <canvas id="captionCanvas').concat(captionCanvasCounter,'" class="caption-canvas"></canvas>\n                <span class="delete-caption">\n                <img src="./src/icons/red-cancel-48.png"/></span>\n\n                <span class="increase-caption-size">\n                <img src="./src/icons/purple-add-new-48.png"/></span>\n\n                <span class="decrease-caption-size">\n                <img src="./src/icons/purple-reduce-48.png"/></span>\n            <div class="stretch-y editable-caption">\n              <span class="hidden-caption" id="target-caption').concat(captionCanvasCounter,'">').concat(e,"</span>\n            </div>\n          </div>"));var i=document.getElementById("captionCanvas"+captionCanvasCounter),c=(i.getContext("2d"),$("#caption-canvas-container"+captionCanvasCounter));c.css({"z-index":10*(manipulationNumber+1)+10*captionCanvasCounter+4,top:o,left:r}),c.hover(function(e){c.addClass("shakeable")},function(e){c.removeClass("shakeable")});var s=a||32,d=$("#target-caption".concat(captionCanvasCounter));d.css({"font-family":"Verdana","font-size":s+"px"}),i.width=c.width(),i.height=c.height();var u=getCaptionIndexByID(c.get(0).id);-1===u?captionArray.push({id:"caption-canvas-container"+captionCanvasCounter,caption:"",font:s,width:i.width,height:i.height,xPosition:o,yPosition:r,color:"rgb(255,255,255)"}):(captionArray[u].font=s,captionArray[u].width=i.width,captionArray[u].height=i.height),d.addClass("nonactive-caption"),c.hover(function(){$(".delete-caption").addClass("active"),$(".increase-caption-size").addClass("active"),$(".decrease-caption-size").addClass("active"),$("div.editable-caption").css({"border-style":"none"})},function(){$(".delete-caption").removeClass("active"),$(".increase-caption-size").removeClass("active"),$(".decrease-caption-size").removeClass("active"),$("div.editable-caption").css({"border-style":"dashed","border-color":"rgb(0, 0, 0, 0.4)","border-width":"1px"})}),c.on("dblclick",function(){d.attr("contentEditable",!0),d.focus(),d.text(""),d.get(0).style.color="rgba(0, 0, 0, 0.4)",c.draggable("disable"),c.removeClass("shakeable"),captionArray[getCaptionIndexByID(c.get(0).id)].caption="",d.bind("DOMCharacterDataModified",clearText),d.bind("keydown",setText)}),d.focusout(l,function(){var e=$("#".concat(this.id)),t=$("#"+this.parentElement.parentElement.id);t.draggable("enable"),t.removeClass("shakeable");var n=t.find("canvas").get(0),a=n.getContext("2d");if(e.text()){var o=getCaptionIndexByID(t.get(0).id),r=e.text();-1!==o&&(captionArray[o].caption=r),t.remove();var i=t.offset().left-$("#parent-container").offset().left,c=t.offset().top-$("#parent-container").offset().top;handleCaptionClick(l,r,!1,o+1,captionArray[o].font,"",i,c);a=(n=(t=$("#"+t.get(0).id)).find("canvas").get(0)).getContext("2d");document.getElementById("target-caption".concat(o+1)).style.color="rgba(0, 0, 0, 0)";n.getBoundingClientRect();s=fitTextOnCanvas(a,n,r,"Verdana",captionArray[o].font,"rgb(".concat(currentColorRGBValues.red,",").concat(currentColorRGBValues.green,",").concat(currentColorRGBValues.blue,")")),captionArray[o].font=s,captionArray[o].caption=r,captionArray[o].color="rgb(".concat(currentColorRGBValues.red,",").concat(currentColorRGBValues.green,",").concat(currentColorRGBValues.blue,")")}else e.text("Enter Something"),e.get(0).style.color="rgba(0, 0, 0, 0.4)",captionArray[getCaptionIndexByID(t.get(0).id)].caption="",a.clearRect(0,0,n.width,n.height)}),c.draggable({containment:"#parent-container"}),$("#caption-canvas-container".concat(captionCanvasCounter," .delete-caption")).mousedown(function(e){var t=$("#"+this.parentElement.id);t.off(),t.remove()}),$("#caption-canvas-container".concat(captionCanvasCounter," .increase-caption-size")).mousedown(function(e){var t=$("#"+this.parentElement.id),n=t.find("span.hidden-caption"),a=t.find("canvas"),o=getCaptionIndexByID(this.parentElement.id);-1!==o&&(increaseCaptionSize(e,$("#"+this.parentElement.id),n,a,o),a=document.getElementById(a.get(0).id),n=$("#".concat(n.get(0).id)),captionArray[o].caption&&(s=fitTextOnCanvas(a.getContext("2d"),a,n.text(),"Verdana",captionArray[o].font,captionArray[o].color)))}),$("#caption-canvas-container".concat(captionCanvasCounter," .decrease-caption-size")).mousedown(function(e){var t=$("#"+this.parentElement.id),n=t.find("span.hidden-caption"),a=t.find("canvas"),o=getCaptionIndexByID(this.parentElement.id);-1!==o&&(decreaseCaptionSize(e,$("#"+this.parentElement.id),n,a,o),a=document.getElementById(a.get(0).id),n=$("#".concat(n.get(0).id)),captionArray[o].caption&&(s=fitTextOnCanvas(a.getContext("2d"),a,n.text(),"Verdana",captionArray[o].font,captionArray[o].color)))}),captionCanvasCounter=t?captionCanvasCounter+1:captionCanvasCounter,isOverlayChanged=!0}else alert("Too many captions present!!! Can't create any more.")}function clearText(e){var t=$("#".concat(e.target.parentElement.parentElement.id)).find("canvas").get(0);t.getContext("2d").clearRect(0,0,t.width,t.height),$("#"+e.target.id).unbind("DOMCharacterDataModified",clearText)}function setText(e){13===e.keyCode&&($("#"+e.target.id).unbind("keydown",setText),document.getElementById(e.target.id).blur())}function increaseCaptionSize(e,t,n,a,o){var r=t.offset().left-$("#parent-container").offset().left,i=t.offset().top-$("#parent-container").offset().top,c=t.get(0).id;t.remove();var l=captionArray[o].font+4;(handleCaptionClick(e,n.text(),!1,getCaptionIndexByID(c)+1,l,"",r,i),captionArray[getCaptionIndexByID(c)].caption)?$("#target-caption".concat(getCaptionIndexByID(c)+1)).css({color:"rgba(0, 0, 0, 0)"}):$("#target-caption".concat(getCaptionIndexByID(c)+1)).css({color:"rgba(0, 0, 0, 0.4)"})}function decreaseCaptionSize(e,t,n,a,o){var r=t.offset().left-$("#parent-container").offset().left,i=t.offset().top-$("#parent-container").offset().top,c=t.get(0).id;t.remove();var l=24<=captionArray[o].font?captionArray[o].font-4:captionArray[o].font;(handleCaptionClick(e,n.text(),!1,getCaptionIndexByID(c)+1,l,"",r,i),captionArray[getCaptionIndexByID(c)].caption)?$("#target-caption".concat(getCaptionIndexByID(c)+1)).css({color:"rgba(0, 0, 0, 0)"}):$("#target-caption".concat(getCaptionIndexByID(c)+1)).css({color:"rgba(0, 0, 0, 0.4)"})}function initiateCaptionColorPicker(){var e=document.querySelectorAll("input.color-input"),t=document.getElementById("redCaptionColorSelector").value,n=document.getElementById("greenCaptionColorSelector").value,a=document.getElementById("blueCaptionColorSelector").value;if((colorPickerDisplay=document.getElementById("colorCaptionDisplay"))&&t&&n&&a&&(colorPickerDisplay.style.background="rgba(".concat(t,", ").concat(n,", ").concat(a,", 1)")),e&&0<e.length)for(var o=0;o<e.length;o++)e[o].addEventListener("input",function(){t=document.getElementById("redCaptionColorSelector").value,n=document.getElementById("greenCaptionColorSelector").value,a=document.getElementById("blueCaptionColorSelector").value,(colorPickerDisplay=document.getElementById("colorCaptionDisplay"))&&t&&n&&a&&(colorPickerDisplay.style.background="rgba(".concat(t,", ").concat(n,", ").concat(a,", 1)"),currentColorRGBValues={red:t,green:n,blue:a,alpha:"1"})});currentColorRGBValues={red:t,green:n,blue:a}}function getCaptionIndexByID(e){for(var t=0;t<captionArray.length;t++)if(captionArray[t].id===e)return t;return-1}function drawCaptionsToCanvas(){if(2===activeTabIndex){addOverlay(base_canvas,"caption");base_canvas.getBoundingClientRect();var n=current_overlay_canvas.getBoundingClientRect();_toConsumableArray(document.querySelectorAll(".caption-canvas")).forEach(function(e){var t=e.getBoundingClientRect();current_overlay_context.drawImage(e,t.left-n.left,t.top-n.top)})}}function fitTextOnCanvas(e,t,n,a,o){var r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"rgb(255,255,255)",i=o;return e.font=i-2+"px "+a,e.shadowColor="black",e.textAlign="center",e.shadowBlur=5,e.lineWidth=3,e.strokeText(n,t.width/2,i),e.shadowBlur=0,e.fillStyle=r,e.fillText(n,t.width/2,i),i}function addOverlay(e,t){current_overlay_id&&$("#".concat(current_overlay_id)).off(),$("#parent-container").append('<div id="overlay-canvas-container'.concat(manipulationNumber+1,'" class="overlay-container">\n                    <canvas id="overlayCanvas').concat(manipulationNumber+1,'" class="overlay-canvas" style="border:1px solid #000000;" tabindex="-1"></canvas>\n                    </div>')),$("#overlay-canvas-container".concat(manipulationNumber+1)).css({"z-index":10*(manipulationNumber+1)+1}),current_overlay_id="overlay-canvas-container".concat(manipulationNumber+1),current_overlay_canvas=document.getElementById("overlayCanvas".concat(manipulationNumber+1)),current_overlay_context=current_overlay_canvas.getContext("2d"),current_overlay_canvas.width=e.width,current_overlay_canvas.height=e.height,current_overlay_canvas.addEventListener("focus",preventFocus),overlayIDArray.push({ID:"overlay-canvas-container".concat(++manipulationNumber),type:t}),clickX=new Array,clickY=new Array,clickDrag=new Array,clickColor=new Array,clickSize=new Array,eraseX=new Array,eraseY=new Array,eraseWidth=new Array,isOverlayChanged=!1}function removeCanvasPointerEvents(){$("canvas").each(function(e,t){$("#".concat(t.id)).css({"pointer-events":"none"})})}function addCanvasPointerEvents(){$("canvas").each(function(e,t){$("#".concat(t.id)).css({"pointer-events":"auto"})})}function removeAllHandlers(){$("canvas").each(function(e,t){$("#".concat(t.id)).off(),$("#".concat(t.parentElement.id)).off()})}function removeLastOverlay(){var e=overlayIDArray.pop();e&&$("#".concat(e)).remove()}function removeOverlayingEmojiCanvases(){$(".emoji-canvas-container").each(function(){$(this).remove()}),emojiArray=[],emojiCanvasCounter=1}function removeOverlayingCaptionCanvases(){$(".caption-canvas-container").each(function(){$(this).remove()}),captionArray=[],captionCanvasCounter=1}function removeCaptionsFromArray(){for(var e in overlayIDArray)"caption"===overlayIDArray[e].type&&overlayIDArray.splice(e,1)}$("#caption").on("click",function(e){if(removeAllHandlers(),$("li#emojis").removeClass("active"),$("li#draw").removeClass("active"),$("li#caption").addClass("active"),$("#caption-container").fadeIn(200),0===activeTabIndex){var t=document.querySelectorAll(".emoji-canvas");t&&0<t.length&&drawEmojisToCanvas(),$("#emoji-container").fadeOut(300,function(){this.remove(),$("#tool-tab-content").append($("#caption-container-template").html()),initiateCaptionColorPicker(),document.getElementById("addCaptionButton").addEventListener("click",function(e){handleCaptionClick(e,"Enter Something",!0,captionArray.length+1)})})}else 1===activeTabIndex&&$("#draw-container").fadeOut(300,function(){this.remove(),$("#tool-tab-content").append($("#caption-container-template").html()),initiateCaptionColorPicker(),document.getElementById("addCaptionButton").addEventListener("click",function(e){handleCaptionClick(e,"Enter Something",!0,captionArray.length+1)})});removeOverlayingEmojiCanvases(),removeCanvasPointerEvents(),current_overlay_canvas&&$("#".concat(current_overlay_canvas.id)).off(),activeTabIndex=2});